<!doctype html><html lang="en"><head><title>KnowBetter based on Icebreakers</title><script defer src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script><meta charset="utf-8"/><meta name="description" content="A collection of icebreaking questions from around the web"/><meta name="twitter:card" content="summary_large_image"><meta name="twitter:description" content="A collection of icebreaking questions from around the web"><meta name="twitter:image" content="https://rendall.github.io/icebreakers/images/1200x675.png"><meta name="twitter:site" content="@rendall"><meta name="twitter:title" content="Icebreakers"><meta name="viewport" content="width=device-width,initial-scale=1"/><meta property="og:description" content="A collection of icebreaking questions from around the web"><meta property="og:image" content="https://rendall.github.io/icebreakers/images/1200x1200.png"><meta property="og:title" content="Icebreakers"><meta property="og:url" content="https://rendall.github.io/icebreakers/"><link rel="icon" type="image/png" href="favicon.svg"/><link rel="preconnect" href="https://fonts.googleapis.com"/><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/><script defer="defer" src="main.js?v=2"></script><!-- Place this AFTER the existing main.js include -->
<script>
(function () {
  // --- This is the updated image capture function ---
  async function captureShareImage() {
    const target = document.querySelector('#capture-root') || document.body;

    // 1) Take a "screenshot" of the text and layout
    const scale = Math.min(2, window.devicePixelRatio || 2);
    const domCanvas = await window.html2canvas(target, {
      backgroundColor: null, // Transparent background
      scale
    });
    const W = domCanvas.width;
    const H = domCanvas.height;

    // 2) Create a new canvas to draw on
    const canvas = document.createElement('canvas');
    canvas.width = W;
    canvas.height = H;
    const ctx = canvas.getContext('2d');

    // 3) Read the page's CSS variables to get current colors and image
    const css = getComputedStyle(document.documentElement);
    const surface = (css.getPropertyValue('--theme-background') || '#0f0f11').trim();
    const bgVar = css.getPropertyValue('--bg-image') || '';
    let bgUrl = null;
    const m = bgVar.match(/url\((?:'|")?(.+?)(?:'|")?\)/i);
    if (m && m[1]) bgUrl = m[1];

    const bgOpacity = parseFloat(css.getPropertyValue('--bg-opacity')) || 0.2;
    const duoA = (css.getPropertyValue('--duo-a') || '#f784c5').trim();
    const duoB = (css.getPropertyValue('--duo-b') || '#1b602f').trim();
    const accent = (css.getPropertyValue('--accent') || '#000072').trim();

    // 4) Fill the canvas with the base theme color
    ctx.fillStyle = surface;
    ctx.fillRect(0, 0, W, H);

    // Helper to make the background image grayscale
    function grayify() {
      const imgData = ctx.getImageData(0, 0, W, H);
      const d = imgData.data;
      for (let i = 0; i < d.length; i += 4) {
        const r = d[i], g = d[i + 1], b = d[i + 2];
        const gy = Math.round(0.2126 * r + 0.7152 * g + 0.0722 * b);
        d[i] = d[i + 1] = d[i + 2] = gy;
      }
      ctx.putImageData(imgData, 0, 0);
    }

    // 5) Draw the background image if it exists
    if (bgUrl) {
      await new Promise((resolve, reject) => {
        const img = new Image();
        img.crossOrigin = 'anonymous';
        img.onload = () => {
          const iw = img.naturalWidth, ih = img.naturalHeight;
          const ir = iw / ih, cr = W / H;
          let dw = W, dh = H;
          if (ir > cr) { dh = H; dw = dh * ir; } else { dw = W; dh = dw / ir; }
          const dx = (W - dw) / 2, dy = (H - dh) / 2;

          ctx.save();
          ctx.globalAlpha = bgOpacity;
          ctx.drawImage(img, dx, dy, dw, dh);
          grayify(); // Apply grayscale filter
          ctx.restore();
          resolve();
        };
        img.onerror = reject;
        img.src = bgUrl;
      });
    }

    // 6) Recreate the duotone color overlay
    (function addDuotone() {
      ctx.globalCompositeOperation = 'multiply';
      const radial = ctx.createRadialGradient(W * 0.2, H * 0.2, 0, W * 0.2, H * 0.2, Math.max(W, H) * 0.6);
      radial.addColorStop(0, duoA + '66');
      radial.addColorStop(1, '#0000');
      ctx.fillStyle = radial;
      ctx.fillRect(0, 0, W, H);

      const lin = ctx.createLinearGradient(0, 0, W, H);
      lin.addColorStop(0, duoA + '73');
      lin.addColorStop(1, duoB + '73');
      ctx.fillStyle = lin;
      ctx.fillRect(0, 0, W, H);

      const top = ctx.createLinearGradient(0, 0, 0, H);
      top.addColorStop(0, accent + '1A');
      top.addColorStop(1, '#0000');
      ctx.fillStyle = top;
      ctx.fillRect(0, 0, W, H);
      ctx.globalCompositeOperation = 'source-over';
    })();

    // 7) Place the text and layout on top
    ctx.drawImage(domCanvas, 0, 0);

    // 8) Prepare the final image for sharing or download
    const blob = await new Promise((res) => canvas.toBlob(res, 'image/png', 1));
    const file = new File([blob], 'icebreaker.png', { type: 'image/png' });
    return { blob, file };
  }

  // --- This is the updated share/download function ---
  async function doShareOrDownload() {
    try {
      const { blob, file } = await captureShareImage(); // Use the new function
      if (navigator.canShare && navigator.canShare({ files: [file] })) {
        await navigator.share({ files: [file], title: 'Icebreaker' });
      } else {
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'icebreaker.png';
        document.body.appendChild(a);
        a.click();
        a.remove();
        URL.revokeObjectURL(url);
        alert('Image saved. Upload to Instagram Stories or TikTok.');
      }
    } catch (e) {
      console.error(e);
      alert('Sharing failed. Please try again or save the image manually.');
    }
  }

  // --- Wire up the buttons ---
  document.addEventListener('DOMContentLoaded', () => {
    // Make sure to include the footer in the screenshot
    const main = document.querySelector('main');
    const footer = document.querySelector('footer');
    if (main && footer && !document.getElementById('capture-root')) {
      const wrapper = document.createElement('div');
      wrapper.id = 'capture-root';
      main.parentNode.insertBefore(wrapper, main);
      wrapper.appendChild(main);
      wrapper.appendChild(footer);
    }

    const share = document.getElementById('post-link');
    if (share) {
      const clone = share.cloneNode(true);
      share.replaceWith(clone);
      clone.addEventListener('click', (e) => { e.preventDefault(); doShareOrDownload(); });
    }
  });
})();
</script>
<link href="main.css" rel="stylesheet"></head><body><main><h2 id="question-display">...</h2></main><footer><button id="reload-button" class="footer-col-2">Rakyat Bertanya</button><button id="post-link" class="footer-col-2" title="Bagikan" aria-label="Bagikan">
  <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20"
       viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
    <path d="M 18 2 A 3 3 0 0 0 15 5 A 3 3 0 0 0 15.054688 5.5605469 L 7.9394531 9.7109375 A 3 3 0 0 0 6 9 A 3 3 0 0 0 3 12 A 3 3 0 0 0 6 15 A 3 3 0 0 0 7.9355469 14.287109 L 15.054688 18.439453 A 3 3 0 0 0 15 19 A 3 3 0 0 0 18 22 A 3 3 0 0 0 21 19 A 3 3 0 0 0 18 16 A 3 3 0 0 0 16.0625 16.712891 L 8.9453125 12.560547 A 3 3 0 0 0 9 12 A 3 3 0 0 0 8.9453125 11.439453 L 16.060547 7.2890625 A 3 3 0 0 0 18 8 A 3 3 0 0 0 21 5 A 3 3 0 0 0 18 2 z"/>
  </svg>
</button>
<ul class="footer-col-1"><li><label>Got a nice answer? <ul class="actions">
<div class="actions-row">
  <a id="download-link" href="#">Download image</a>
  <a id="copy-link" href="#">Copy image</a>
</div>
  <li><label>Iseng2nya <a id="credit-link" href=""></a></label></li>
</ul>
</label></li></li></ul><div class="footer-col-3"><ul><li><a href="https://github.com/rendall/icebreakers#readme"><em>RakyatBertanya </em> based on <em>Icebreakers</em></a></li><li><a href="https://rendall.github.io/icebreakers">kamibertanya.netlify.app/</a></li></ul><button id="change-theme-button" title="Change color theme" aria-label="Change color theme"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" x="0px" y="0px" viewBox="0 0 64 64" enable-background="new 0 0 64 64" xml:space="preserve"><g><path d="M32,61c-7.8,0-15.2-3.1-20.7-8.7c-5.5-5.6-8.5-13-8.3-20.8C3.2,16.5,15.2,4,30.2,3.1c10.8-0.7,20.7,4.5,26.4,13.5   c0.6,0.9,0.6,2,0.1,3c-0.6,1.1-1.8,1.7-3.1,1.5C53,21,52.5,21,52,21c-5.9,0-10.8,4.8-11,10.6c-0.1,3,1,5.9,3.1,8   C46.2,41.8,49,43,52,43c0.5,0,1,0,1.5-0.1c1.3-0.2,2.5,0.4,3.1,1.5c0.5,1,0.5,2.1-0.1,3C51.2,55.9,42,61,32,61z M32,5   c-0.6,0-1.1,0-1.7,0.1C16.3,5.9,5.2,17.6,5,31.6c-0.1,7.3,2.6,14.2,7.8,19.4C17.9,56.1,24.7,59,32,59c9.3,0,17.9-4.7,22.8-12.6   c0.3-0.4,0.1-0.8,0-1c-0.2-0.3-0.6-0.6-1.1-0.5C53.2,45,52.6,45,52,45c-3.6,0-6.9-1.4-9.3-4c-2.5-2.6-3.8-5.9-3.6-9.5   c0.2-6.9,6-12.5,12.9-12.6l0.1,0c0.6,0,1.2,0,1.8,0.1c0.5,0.1,0.9-0.2,1.1-0.5c0.1-0.2,0.2-0.5,0-0.9C49.9,9.7,41.3,5,32,5z"/><path d="M31,55c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S34.3,55,31,55z M31,45c-2.2,0-4,1.8-4,4s1.8,4,4,4s4-1.8,4-4S33.2,45,31,45z"/><path d="M16,46c-2.2,0-4-1.8-4-4s1.8-4,4-4s4,1.8,4,4S18.2,46,16,46z M16,40c-1.1,0-2,0.9-2,2s0.9,2,2,2s2-0.9,2-2S17.1,40,16,40z"/><path d="M12,34c-2.2,0-4-1.8-4-4s1.8-4,4-4s4,1.8,4,4S14.2,34,12,34z M12,28c-1.1,0-2,0.9-2,2s0.9,2,2,2s2-0.9,2-2S13.1,28,12,28z"/><path d="M18,22c-2.2,0-4-1.8-4-4s1.8-4,4-4s4,1.8,4,4S20.2,22,18,22z M18,16c-1.1,0-2,0.9-2,2s0.9,2,2,2s2-0.9,2-2S19.1,16,18,16z"/><path d="M30,16c-2.2,0-4-1.8-4-4s1.8-4,4-4s4,1.8,4,4S32.2,16,30,16z M30,10c-1.1,0-2,0.9-2,2s0.9,2,2,2s2-0.9,2-2S31.1,10,30,10z"/></g></svg></button></div></footer></body></html>